---
title: http协议笔记
date: 2022-08-07
tags:
  - http
summary: http
---
## URL
1. Uniform Resource Locator(统一资源定位符)
2. 组成：http://user:pass@hotst.com:80/path?query=string#hash
* http: // 协议，如http、ftp、file
* user:pass // 极少使用，可以忽略
* host.com // 域名，会经DNS解析成IP，IP就是请求资源的服务器地址
* 80 // 端口号，默认端口号80
* path // 路由
* query // 参数
* \#hash // #后面跟的是hash

## http组成
### 请求
* 请求行
* 首部
* 实体
### 响应
* 状态行
* 首部
* 实体
## 跨域
### 跨域产生的条件? 
> 协议、端口号、域名之中有任一不同，即产生跨域
### 设置了Access-Control-Allow-Origin: * 就可以解决跨域了?
> 简单请求下是可以的，非简单请求则不行
### 简单请求
#### 请求方法
1. GET
2. POST
3. HEAD
#### 请求头
1. Accept
2. Accept-Language
3. Content-Language
4. Content-Type: text/plain, multipart/form-data, application/x-wwww-form-urlencoded
5. Last-Event-ID
> 同时满足以上两种情况就是简单请求，否则非简单请求
### 非简单请求
请求方法
1. PUT
2. DELETE
3. Content-Type: application/json
4. 自定义请求头header如X-Tianzhen: 1

> 非简单请求会发起预请求options，检测是否支持跨域, 设置跨域时间 `Access-Control-Max-Age：600`单位：s，上限：2h,浏览器实现不一致
### \* 有安全问题，如果设置域名，如何设置多个？
> 服务端配置域名列表，动态条件设置
## 缓存
### Expires(强缓存)
> expires: 2022-2-2。缺点：返回的是服务器时间，比较的是客户端时间，可能不一致
### Cache-Control
#### 可缓存性
1. public // 任何都放都可以缓存
2. private // 只能在发起的浏览器缓存
3. no-cache // 允许缓存，但每次都需要到服务器验证后才能使用
#### 缓存时间
1. max-age: seconds // 多少秒后过期(`强缓存`)
2. s-maxage: seconds // 优先级更高，作用于代理服务器设置
3. max-stale: seconds // 发起方设置了此信息头，表示在max-age过期之后seconds秒内还可以使用过期的缓存，浏览器中无效，因为浏览器不会主动设置此头
#### 重新验证
1. must-revalidate // max-age到期之后，必须去源服务端发送请求验证是否过期
1. proxy-revalidate // 与max-revalidate相似，指缓存服务器
##### 其他
* no-store // 不使用缓存，即使设置了max-age
* no-transform // 告诉代理服务器不要使用转换(如：压缩)
### 缓存验证
#### Last-Modified
> 与浏览器携带If-Modified-Since或If-Unmodified-Since对比，来验证资源是否需要更新
#### Etag(数据签名)
> 与浏览器携带If-Match或这If-Non-Match比对，对比资源签名是否需要更新
#### Last-Modified和Max-Age的局限性
* 对于模板渲染的页面，每次重新渲染之后会使Last-Modified失效，而Max-Age无法精确控制，这种场景Etag就更合适
* Nginx-> Etag: on
### cookie
> [见Cookie-Session-Token](/blog-vuepress/browser/2022/08/09/cookie-session-token)
### 数据协商
#### 请求Accept
1. Accept:
2. Accept-Encoding
3. Accept-Language
4. User-Agent
#### 响应Content
1. Content-type
2. Content-Language
3. Content-Encoding
### Redirect
1. 301(永久重定向)，Location: url // 缓存在客户端，除非手动清除
2. 302(临时重定向), Location: url