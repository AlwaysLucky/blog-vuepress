---
title: 使用wireshark分析tcp三次握手
date: 2022-07-25
tags:
  - tcp
summary: 三次握手
---

![tcp](https://tzhen.vip/assets/tcp.png)
## 流程如下
1. 第一次：客户端发送SYN标识位，seq序列号到服务器端，客户端状态：`SYN_SEND`
2. 第二次：服务器端发送SYN标识位，ACK标识位，ack确认号，seq序列号, 服务器端状态：`SYN_RCVD`
    1. Ack=J+1(J为第一次seq的值)
3. 客户端发送ACK标识位，ack确认号，客户端状态：`ESTABLISHED`
    1. Ack=K+1(K为第二次seq的值)
4. 服务器端收到ACK，进入`ESTABLISHED`，不算握手
> Ack=Seq+1
## 字段认识
* seq： 序号(解决网络包乱序)
* ack：确认号(解决网络包丢失)
* 标识位6个
  * ACK：确认号(Acknowledgement)
  * SYN：请求同步(Synchronization)
  * URG：紧急指针
  * PUSH：接收方应尽快将这个报文交给应用层
  * RST：重置连接
  * FIN：释放一个连接
> 1表示开启，0表示关闭
## 使用wireshark来分析三次握手的过程
![tcp1](https://tzhen.vip/assets/tcp1.png)
### 第一次握手分析
1. [SYN]
2. Seq = 0
3. MSS=1460,最大报文长度
![tcp2](https://tzhen.vip/assets/tcp2.png)
### 第二次握手分析
1. [SYN, ACK]
2. Seq=1
3. Ack=1
![tcp3](https://tzhen.vip/assets/tcp3.png)
### 第三次握手分析
1. [ACK]
2. Seq=1
3. Ack=1
## 为什么握手是三次？
因为要保持连接和可靠性约束，`TCP` 协议要保证每一条发出的数据必须给出`ACK`（也就是响应）。
* 第一次客户端发送`SYN`表示请求建立连接
* 第二次服务器端发送`SYN` `ACK`之后，表示服务器端已经准备好了，但此时还不知道客户端是否也准备好，所以需要第三次握手








<!-- TCP 是一个双工协议，为了让双方都保证，建立连接的时候，连接双方都需要向对方发送 SYC（同步请求）和 ACK（响应）。

握手阶段双方都没有烦琐的工作，因此一方向另一方发起同步（SYN）之后，另一方可以将自己的 ACK 和 SYN 打包作为一条消息回复，因此是 3 次握手——需要 3 次数据传输。 -->





















<!-- ## IP： internet protocol（网络协议）
> 数据包是如何传输的?
数据包在发送到目标主机之前，会在本身携带目标IP地址（寻址）、源IP地址(目标主机回复信息)，而这些信息会封装在IP头的数据结构中，IP头是IP数据包开头的信息，包括（源IP地址、目标IP地址、版本号、生存时间等）

> IP只负责数据包的传输，不知道要到哪个应用

> UDP、TCP协议，基于IP之上和应用打交道


## UDP: user datagrma protocol（用户数据协议）
* UDP头中携带了端口号
* 优点：数据传输速度非常快，因此在对数据完整性要求不是很高的情景下适用（游戏，语音）
* 缺点1: 数据传输过程容易丢失，没有重传机制
* 缺点2: 大数据会分成一个个的小数据包经不同路由，不同时间到达接收端，UDP无法有序组装这些数据包，还原完整文件


## TCP：transmission control protocol（传输控制协议）
* 针对丢包，支持重传机制
* 引入数据包排序机制，保证了把乱数数据包合成完整文件


## 总结
* IP负责把数据包送到目标主机
* UDP负责把数据包送达具体应用
* TCP保证了数据的完整传输，tcp连接分三个阶段：建立连接、传输数据、断开连接

连接阶段：TCP三次握手建立连接
传输阶段：接收方需要发送确认到发送方，如果在规定时间内没有收到接收方反馈，则认为数据包丢失，触发发送端重发机制 -->